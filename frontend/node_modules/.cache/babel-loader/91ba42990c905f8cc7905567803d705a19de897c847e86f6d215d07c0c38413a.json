{"ast":null,"code":"var _jsxFileName = \"/home/uni5/web-notification-id/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Convert the public VAPID key to Uint8Array\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\nconst App = () => {\n  _s();\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const publicVapidKey = 'BIOOXS25u5s7CIKwFvWHTf-k9tJn3aQKVp3vbJRu_lQ1Vk_rsKfHyAXnvkRgkU92eCO8mZ-Z8qyZ_H3oqw3fY5U'; // Same key as in backend\n\n  // Request permission for push notifications\n  const requestNotificationPermission = async () => {\n    const permission = await Notification.requestPermission();\n    if (permission === 'granted') {\n      console.log('Permission granted for notifications');\n      subscribeToPushNotifications();\n    } else {\n      console.error('Permission denied for notifications');\n    }\n  };\n\n  // Subscribe user to push notifications\n  const subscribeToPushNotifications = async () => {\n    try {\n      const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n      const pushSubscription = await serviceWorkerRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(publicVapidKey)\n      });\n      const subscription = {\n        endpoint: pushSubscription.endpoint,\n        keys: {\n          p256dh: pushSubscription.getKey('p256dh'),\n          auth: pushSubscription.getKey('auth')\n        }\n      };\n\n      // Log the keys for debugging\n      console.log(\"p256dh:\", subscription.keys.p256dh);\n      console.log(\"auth:\", subscription.keys.auth);\n      const userId = uuidv4(); // You can dynamically generate user ID or retrieve it from app state\n\n      // Send the subscription to the backend\n      await fetch('http://localhost:5000/subscribe', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          subscription,\n          userId\n        })\n      });\n      setIsSubscribed(true); // Update state to reflect the subscription status\n      console.log('User subscribed:', userId);\n    } catch (error) {\n      console.error('Error subscribing to push notifications:', error);\n    }\n  };\n\n  // Button click handler to request notifications\n  const handleSubscribeButtonClick = () => {\n    requestNotificationPermission();\n  };\n\n  // Send notification to all users\n  const handleSendNotificationButtonClick = async () => {\n    const title = 'New Notification';\n    const message = 'You have a new notification!';\n    try {\n      const response = await fetch('http://localhost:5000/send-notification-to-all', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          title,\n          message\n        })\n      });\n      if (response.ok) {\n        console.log('Notifications sent successfully');\n      } else {\n        console.error('Failed to send notifications:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error sending notifications:', error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: !isSubscribed ? /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSubscribeButtonClick,\n      children: \"Subscribe to Notifications\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"You are subscribed to notifications!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSendNotificationButtonClick,\n        children: \"Send Notification to All Users\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 5\n  }, this);\n};\n_s(App, \"u7ts92eeZ8YtPu0ix0ZCMZj0B6k=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useState","v4","uuidv4","jsxDEV","_jsxDEV","urlBase64ToUint8Array","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","App","_s","isSubscribed","setIsSubscribed","publicVapidKey","requestNotificationPermission","permission","Notification","requestPermission","console","log","subscribeToPushNotifications","error","serviceWorkerRegistration","navigator","serviceWorker","ready","pushSubscription","pushManager","subscribe","userVisibleOnly","applicationServerKey","subscription","endpoint","keys","p256dh","getKey","auth","userId","fetch","method","headers","body","JSON","stringify","handleSubscribeButtonClick","handleSendNotificationButtonClick","title","message","response","ok","statusText","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/uni5/web-notification-id/frontend/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Convert the public VAPID key to Uint8Array\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/\\-/g, '+')\n    .replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\nconst App = () => {\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const publicVapidKey = 'BIOOXS25u5s7CIKwFvWHTf-k9tJn3aQKVp3vbJRu_lQ1Vk_rsKfHyAXnvkRgkU92eCO8mZ-Z8qyZ_H3oqw3fY5U'; // Same key as in backend\n\n  // Request permission for push notifications\n  const requestNotificationPermission = async () => {\n    const permission = await Notification.requestPermission();\n    if (permission === 'granted') {\n      console.log('Permission granted for notifications');\n      subscribeToPushNotifications();\n    } else {\n      console.error('Permission denied for notifications');\n    }\n  };\n\n  // Subscribe user to push notifications\n  const subscribeToPushNotifications = async () => {\n    try {\n      const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n      const pushSubscription = await serviceWorkerRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(publicVapidKey),\n      });\n\n      const subscription = {\n        endpoint: pushSubscription.endpoint,\n        keys: {\n          p256dh: pushSubscription.getKey('p256dh'),\n          auth: pushSubscription.getKey('auth'),\n        },\n      };\n\n      // Log the keys for debugging\n      console.log(\"p256dh:\", subscription.keys.p256dh);\n      console.log(\"auth:\", subscription.keys.auth);\n\n      const userId = uuidv4(); // You can dynamically generate user ID or retrieve it from app state\n\n      // Send the subscription to the backend\n      await fetch('http://localhost:5000/subscribe', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          subscription,\n          userId,\n        }),\n      });\n\n      setIsSubscribed(true); // Update state to reflect the subscription status\n      console.log('User subscribed:', userId);\n    } catch (error) {\n      console.error('Error subscribing to push notifications:', error);\n    }\n  };\n\n  // Button click handler to request notifications\n  const handleSubscribeButtonClick = () => {\n    requestNotificationPermission();\n  };\n\n  // Send notification to all users\n  const handleSendNotificationButtonClick = async () => {\n    const title = 'New Notification';\n    const message = 'You have a new notification!';\n\n    try {\n      const response = await fetch('http://localhost:5000/send-notification-to-all', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ title, message }),\n      });\n\n      if (response.ok) {\n        console.log('Notifications sent successfully');\n      } else {\n        console.error('Failed to send notifications:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error sending notifications:', error);\n    }\n  };\n\n  return (\n    <div>\n      {!isSubscribed ? (\n        <button onClick={handleSubscribeButtonClick}>Subscribe to Notifications</button>\n      ) : (\n        <div>\n          <p>You are subscribed to notifications!</p>\n          <button onClick={handleSendNotificationButtonClick}>\n            Send Notification to All Users\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}